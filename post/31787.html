<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Nginx反向代理 | Miij's Blog</title><meta name="description" content="Nginx反向代理"><meta name="keywords" content="Nginx"><meta name="author" content="曹志明"><meta name="copyright" content="曹志明"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Nginx反向代理"><meta name="twitter:description" content="Nginx反向代理"><meta name="twitter:image" content="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=240325162,3759124968&amp;fm=26&amp;gp=0.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Nginx反向代理"><meta property="og:url" content="https://caohziming.net/post/31787"><meta property="og:site_name" content="Miij's Blog"><meta property="og:description" content="Nginx反向代理"><meta property="og:image" content="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=240325162,3759124968&amp;fm=26&amp;gp=0.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '2'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://caohziming.net/post/31787"><link rel="prev" title="haproxy 安装及主配参数详解" href="https://caohziming.net/post/9192.html"><link rel="next" title="Nginx Rewrite" href="https://caohziming.net/post/48525.html"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: 曹志明","link":"链接: https://caohziming.net/post/31787","source":"来源: Miij's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.1.1"><link rel="alternate" href="/atom.xml" title="Miij's Blog" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Miij's Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">17</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">8</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-实现http反向代理"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">1 .实现http反向代理</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-1：部署后端Apache服务器"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">1.1：部署后端Apache服务器</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-2-Nginx-http-反向代理入门"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">1.2 Nginx http 反向代理入门</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1-2-1-反向代理配置参数"><span class="toc_mobile_items-number">1.2.1.</span> <span class="toc_mobile_items-text">1.2.1 反向代理配置参数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1-2-2-反向代理示例–单台web服务器"><span class="toc_mobile_items-number">1.2.2.</span> <span class="toc_mobile_items-text">1.2.2 反向代理示例–单台web服务器</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1-2-3-反向代理示例–指定location"><span class="toc_mobile_items-number">1.2.3.</span> <span class="toc_mobile_items-text">1.2.3 反向代理示例–指定location</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1-2-4-反向代理示例–缓存功能"><span class="toc_mobile_items-number">1.2.4.</span> <span class="toc_mobile_items-text">1.2.4 反向代理示例–缓存功能</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1-2-5：添加头部报文信息"><span class="toc_mobile_items-number">1.2.5.</span> <span class="toc_mobile_items-text">1.2.5：添加头部报文信息</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-Nginx-http-反向代理高级应用"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">2. Nginx http 反向代理高级应用</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-1-http-upstream配置参数"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">2.1 http upstream配置参数</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#2-1-1-反向代理示例–多台web服务器"><span class="toc_mobile_items-number">2.1.1.</span> <span class="toc_mobile_items-text">2.1.1 反向代理示例–多台web服务器</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#2-1-2-反向代理示例–客户端IP透传"><span class="toc_mobile_items-number">2.1.2.</span> <span class="toc_mobile_items-text">2.1.2 反向代理示例–客户端IP透传</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-实现http反向代理"><span class="toc-number">1.</span> <span class="toc-text">1 .实现http反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1：部署后端Apache服务器"><span class="toc-number">1.1.</span> <span class="toc-text">1.1：部署后端Apache服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Nginx-http-反向代理入门"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 Nginx http 反向代理入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-反向代理配置参数"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 反向代理配置参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-反向代理示例–单台web服务器"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 反向代理示例–单台web服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-反向代理示例–指定location"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 反向代理示例–指定location</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-反向代理示例–缓存功能"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 反向代理示例–缓存功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-5：添加头部报文信息"><span class="toc-number">1.2.5.</span> <span class="toc-text">1.2.5：添加头部报文信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Nginx-http-反向代理高级应用"><span class="toc-number">2.</span> <span class="toc-text">2. Nginx http 反向代理高级应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-http-upstream配置参数"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 http upstream配置参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-反向代理示例–多台web服务器"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 反向代理示例–多台web服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-反向代理示例–客户端IP透传"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 反向代理示例–客户端IP透传</span></a></li></ol></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=240325162,3759124968&amp;fm=26&amp;gp=0.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">Nginx反向代理</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-01-07<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-01-09</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Nginx/">Nginx</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.4k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 14 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>﻿## Nginx 的反向代理功能</p>
<p><strong>反向代理：反向代理也叫reverse proxy，指的是代理外网用户的请求到内部的指定web服务器，并将数据返回给用户的一种方式，这是用的比较多的一种方式。</strong></p>
<p><strong>Nginx除了可以在企业提供高性能的web服务之外，另外还可以将本身不具备的请求通过某种预定义的协议转发至其它服务器处理，不同的协议就是Nginx服务器与其他服务器进行通信的一种规范，主要在不同的场景使用以下模块实现不同的功能：</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ngx_http_proxy_module： 将客户端的请求以http协议转发至指定服务器进行处理。</span><br><span class="line">ngx_stream_proxy_module：将客户端的请求以tcp协议转发至指定服务器处理。</span><br><span class="line">ngx_http_fastcgi_module：将客户端对php的请求以fastcgi协议转发至指定服务器助理。</span><br><span class="line">ngx_http_uwsgi_module：将客户端对Python的请求以uwsgi协议转发至指定服务器处理。</span><br></pre></td></tr></table></figure></div>

<p><strong>逻辑调用关系：</strong><br><a href="https://img-blog.csdnimg.cn/20200107174152141.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTM0MTUwNw==,size_16,color_FFFFFF,t_70" target="_blank" rel="noopener" data-fancybox="group" data-caption="在这里插入图片描述" class="fancybox"><img alt="在这里插入图片描述" title="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/20200107174152141.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTM0MTUwNw==,size_16,color_FFFFFF,t_70" class="lazyload"></a></p>
<p><strong>生产环境部署结构：</strong></p>
<p>图片源于马哥教育教材<br><a href="https://img-blog.csdnimg.cn/20200107174156190.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTM0MTUwNw==,size_16,color_FFFFFF,t_70" target="_blank" rel="noopener" data-fancybox="group" data-caption="在这里插入图片描述" class="fancybox"><img alt="在这里插入图片描述" title="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/20200107174156190.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTM0MTUwNw==,size_16,color_FFFFFF,t_70" class="lazyload"></a></p>
<h2 id="1-实现http反向代理"><a href="#1-实现http反向代理" class="headerlink" title="1 .实现http反向代理"></a>1 .实现http反向代理</h2><p>#要求：将用户对域 <a href="http://www.daming.net的请求转发值后端服务器处理，" target="_blank" rel="noopener">www.daming.net的请求转发值后端服务器处理，</a></p>
<p>#官方文档： <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html，" target="_blank" rel="noopener">https://nginx.org/en/docs/http/ngx_http_proxy_module.html，</a></p>
<p><strong>环境准备：</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.66.7   <span class="comment"># Nginx 代理服务器</span></span><br><span class="line">192.168.66.17  <span class="comment"># 后端web A，Apache部署</span></span><br><span class="line">192.168.66.27  <span class="comment"># 后端web B，Apache部署</span></span><br></pre></td></tr></table></figure></div>

<p><strong>访问逻辑图:</strong></p>
<p><a href="https://img-blog.csdnimg.cn/20200107174247691.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTM0MTUwNw==,size_16,color_FFFFFF,t_70" target="_blank" rel="noopener" data-fancybox="group" data-caption="在这里插入图片描述" class="fancybox"><img alt="在这里插入图片描述" title="在这里插入图片描述" data-src="https://img-blog.csdnimg.cn/20200107174247691.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTM0MTUwNw==,size_16,color_FFFFFF,t_70" class="lazyload"></a></p>
<h3 id="1-1：部署后端Apache服务器"><a href="#1-1：部署后端Apache服务器" class="headerlink" title="1.1：部署后端Apache服务器"></a>1.1：部署后端Apache服务器</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@s3 ~]<span class="comment"># yum install httpd -y</span></span><br><span class="line">[root@s3 ~]<span class="comment"># echo "web1 192.168.66.17" &gt; /var/www/html/index.html</span></span><br><span class="line">[root@s3 ~]<span class="comment"># systemctl start httpd &amp;&amp; systemctl enable httpd</span></span><br><span class="line">[root@s4 ~]<span class="comment"># yum install httpd -y</span></span><br><span class="line">[root@s4 ~]<span class="comment"># echo "web2 192.168.66.27" &gt;&gt; /var/www/html/index.html</span></span><br><span class="line">[root@s4 ~]<span class="comment"># systemctl start httpd &amp;&amp; systemctl enable httpd</span></span><br><span class="line"><span class="comment">#访问测试</span></span><br><span class="line">[root@s4 ~]<span class="comment"># curl http://192.168.66.17</span></span><br><span class="line">web1 192.168.66.17</span><br><span class="line">[root@s3 ~]<span class="comment"># curl http://192.168.66.27</span></span><br><span class="line">web2 192.168.66.27</span><br></pre></td></tr></table></figure></div>
<h3 id="1-2-Nginx-http-反向代理入门"><a href="#1-2-Nginx-http-反向代理入门" class="headerlink" title="1.2 Nginx http 反向代理入门"></a>1.2 Nginx http 反向代理入门</h3><p>#参看官方文档：<a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass" target="_blank" rel="noopener">https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass</a></p>
<h4 id="1-2-1-反向代理配置参数"><a href="#1-2-1-反向代理配置参数" class="headerlink" title="1.2.1 反向代理配置参数"></a>1.2.1 反向代理配置参数</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">proxy_pass；</span><br><span class="line"><span class="comment">#用来设置将客户端请求转发给的后端服务器的主机，可以是主机名、IP地址：端口的方式，也可以代理到预先设置的</span></span><br><span class="line">主机群组，需要模块gx_http_upstream_module支持。</span><br><span class="line">location /web &#123;</span><br><span class="line"> index index.html;</span><br><span class="line"> proxy_pass http://192.168.66.17:80;</span><br><span class="line">  <span class="comment">#不带斜线将访问的/web,等于访问后端服务器 http://192.168.66.17:80/web/index.html，即后端服务器配置的站点根目录要有web目录才可以被访问，这是一个追加/web到后端服务器</span></span><br><span class="line">http://servername:port/WEB/INDEX.HTML的操作</span><br><span class="line"> proxy_pass http://192.168.66.17:80/;</span><br><span class="line">  <span class="comment">#带斜线，等于访问后端服务器的http://192.168.66.17:80/index.html 内容返回给客户端</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#重启Nginx测试访问效果：</span></span><br><span class="line"><span class="comment"># curl -L http://www.daming.net/web/index.html</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">proxy_hide_header field;</span><br><span class="line"><span class="comment">#用于nginx作为反向代理的时候，在返回给客户端http响应的时候，隐藏后端服务版本相应头部的信息，可以设置在</span></span><br><span class="line">http/server或location块，</span><br><span class="line">location /web &#123;</span><br><span class="line"> index index.html;</span><br><span class="line"> proxy_pass http://192.168.66.17:80/;</span><br><span class="line"> proxy_hide_header ETag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_pass_header field;</span><br><span class="line"><span class="comment">#默认nginx在响应报文中不传递后端服务器的首部字段Date, Server, X-Pad, X-Accel等参数，如果要传递的</span></span><br><span class="line">话则要使用 proxy_pass_header field声明将后端服务器返回的值传递给客户端。</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy_pass_request_body on | off；</span><br><span class="line"><span class="comment">#是否向后端服务器发送HTTP包体部分,可以设置在http/server或location块，默认即为开启</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy_pass_request_headers on | off；</span><br><span class="line"><span class="comment">#是否将客户端的请求头部转发给后端服务器，可以设置在http/server或location块，默认即为开启</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proxy_set_header；</span><br><span class="line"><span class="comment">#可以更改或添加客户端的请求头部信息内容并转发至后端服务器，比如在后端服务器想要获取客户端的真实IP的时</span></span><br><span class="line">候，就要更改每一个报文的头部，如下：</span><br><span class="line"><span class="comment">#proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span><br><span class="line">proxy_set_header X-Forwarded-For  <span class="variable">$remote_addr</span>; </span><br><span class="line"><span class="comment">#添加HOST到报文头部，如果客户端为NAT上网那么其值为客户端的共用的公网IP地址，常用于在日之中记录客户端的真实IP地址。</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxy_connect_timeout time；</span><br><span class="line"><span class="comment">#配置nginx服务器与后端服务器尝试建立连接的超时时间，默认为60秒，用法如下：</span></span><br><span class="line">proxy_connect_timeout 60s；</span><br><span class="line"><span class="comment">#60s为自定义nginx与后端服务器建立连接的超时时间</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxy_read_time time；</span><br><span class="line"><span class="comment">#配置nginx服务器向后端服务器或服务器组发起read请求后，等待的超时时间，默认60s</span></span><br><span class="line">proxy_send_time time；</span><br><span class="line"><span class="comment">#配置nginx项后端服务器或服务器组发起write请求后，等待的超时时间，默认60s</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy_http_version 1.0；</span><br><span class="line"><span class="comment">#用于设置nginx提供代理服务的HTTP协议的版本，默认http 1.0</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxy_ignore_client_abort off；</span><br><span class="line"><span class="comment">#当客户端网络中断请求时，nginx服务器中断其对后端服务器的请求。即如果此项设置为on开启，则服务器会忽略客</span></span><br><span class="line">户端中断并一直等着代理服务执行返回，如果设置为off，则客户端中断后Nginx也会中断客户端请求并立即记录499日</span><br><span class="line">志，默认为off</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">proxy_headers_hash_bucket_size 128；</span><br><span class="line"><span class="comment">#当配置了 proxy_hide_header和proxy_set_header的时候，用于设置nginx保存HTTP报文头的hash表的上</span></span><br><span class="line">限。</span><br><span class="line">proxy_headers_hash_max_size 512；</span><br><span class="line"><span class="comment">#设置proxy_headers_hash_bucket_size的最大可用空间</span></span><br><span class="line">server_namse_hash_bucket_size 512;</span><br><span class="line"><span class="comment">#server_name hash表申请空间大小</span></span><br><span class="line">server_names_hash_max_szie  512;</span><br><span class="line"><span class="comment">#设置服务器名称hash表的上限大小</span></span><br></pre></td></tr></table></figure></div>
<h4 id="1-2-2-反向代理示例–单台web服务器"><a href="#1-2-2-反向代理示例–单台web服务器" class="headerlink" title="1.2.2 反向代理示例–单台web服务器"></a>1.2.2 反向代理示例–单台web服务器</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@s2 conf.d]<span class="comment"># cat pc.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.daming.net;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">	 proxy_pass http://192.168.66.17:80/;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#重启Nginx 并访问测试</span></span><br></pre></td></tr></table></figure></div>
<h4 id="1-2-3-反向代理示例–指定location"><a href="#1-2-3-反向代理示例–指定location" class="headerlink" title="1.2.3 反向代理示例–指定location"></a>1.2.3 反向代理示例–指定location</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.daming.net;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		index index.html index.php;</span><br><span class="line"> root /data/nginx/html/pc;</span><br><span class="line"> &#125;</span><br><span class="line">	location /web &#123;</span><br><span class="line"> <span class="comment">#proxy_pass http://192.168.66.17:80/; #注意有后面的/，</span></span><br><span class="line"> 	proxy_pass http://192.168.66.27:80/;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#后端web服务器必须要有相对于的访问URL</span></span><br><span class="line">[root@s3 ~]<span class="comment"># mkdir /var/www/html/web</span></span><br><span class="line">[root@s3 ~]<span class="comment"># echo "web1 page for apache" &gt; /var/www/html/web/index.html</span></span><br><span class="line">[root@s4 ~]<span class="comment"># mkdir /var/www/html/web</span></span><br><span class="line">[root@s4 ~]<span class="comment"># echo "web2 page for apache" &gt; /var/www/html/web/index.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启Nginx并访问测试：</span></span><br><span class="line">[root@s2 ~]<span class="comment"># curl -L http://www.daming.net/</span></span><br><span class="line">pc web</span><br><span class="line">[root@s2 ~]<span class="comment"># curl -L http://www.daming.net/web</span></span><br><span class="line">web2 page <span class="keyword">for</span> apache</span><br><span class="line"><span class="comment">#Apache的访问日志：</span></span><br><span class="line">[root@s4 ~]<span class="comment"># tail -f /var/log/httpd/access_log</span></span><br><span class="line">192.168.66.7 - - [04/Mar/2019:18:52:00 +0800] <span class="string">"GET /web/ HTTP/1.1"</span> 200 21 <span class="string">"-"</span></span><br><span class="line"><span class="string">"curl/7.29.0"</span></span><br><span class="line">192.168.66.7 - - [04/Mar/2019:18:52:00 +0800] <span class="string">"GET /web HTTP/1.0"</span> 301 233 <span class="string">"-"</span></span><br><span class="line"><span class="string">"curl/7.29.0"</span></span><br><span class="line">192.168.66.7 - - [04/Mar/2019:18:52:00 +0800] <span class="string">"GET /web/ HTTP/1.1"</span> 200 21 <span class="string">"-"</span></span><br><span class="line"><span class="string">"curl/7.29.0"</span></span><br></pre></td></tr></table></figure></div>
<h4 id="1-2-4-反向代理示例–缓存功能"><a href="#1-2-4-反向代理示例–缓存功能" class="headerlink" title="1.2.4 反向代理示例–缓存功能"></a>1.2.4 反向代理示例–缓存功能</h4><p><strong>缓存功能默认关闭状态</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">markdown</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache zone | off; 默认off</span><br><span class="line"><span class="section">#指明调用的缓存，或关闭缓存机制；Context:http, server, location</span></span><br><span class="line"></span><br><span class="line">proxy<span class="emphasis">_cache_</span>key string;</span><br><span class="line"><span class="section">#缓存中用于“键”的内容，默认值：proxy_cache_key $scheme$proxy_host$request_uri;</span></span><br><span class="line"></span><br><span class="line">proxy<span class="emphasis">_cache_</span>valid [code ...] time;</span><br><span class="line"><span class="section">#定义对特定响应码的响应内容的缓存时长，定义在http&#123;...&#125;中</span></span><br><span class="line">示例:</span><br><span class="line"><span class="code">	proxy_cache_valid 200 302 10m;</span></span><br><span class="line"><span class="code">	proxy_cache_valid 404 1m;</span></span><br><span class="line"></span><br><span class="line">proxy<span class="emphasis">_cache_</span>path; #查看官方文档最为准确</span><br><span class="line">定义可用于proxy功能的缓存；Context:http</span><br><span class="line">proxy<span class="emphasis">_cache_</span>path path [levels=levels] [use<span class="emphasis">_temp_</span>path=on|off] keys_zone=name:size</span><br><span class="line">[inactive=time] [max<span class="emphasis">_size=size] [manager_</span>files=number] [manager_sleep=time]</span><br><span class="line">[manager<span class="emphasis">_threshold=time] [loader_</span>files=number] [loader_sleep=time]</span><br><span class="line">[loader<span class="emphasis">_threshold=time] [purger=on|off] [purger_</span>files=number] [purger_sleep=time]</span><br><span class="line">[purger_threshold=time];</span><br><span class="line"><span class="strong">**示例：在http配置定义缓存信息**</span></span><br><span class="line"> proxy<span class="emphasis">_cache_</span>path /var/cache/nginx/proxy<span class="emphasis">_cache #定义缓存保存路径，proxy_</span>cache会自动创建</span><br><span class="line"> levels=1:2:2 #定义缓存目录结构层次，1:2:2可以生成2^4x2^8x2^8=1048576个目录</span><br><span class="line"> keys_zone=proxycache:20m #指内存中缓存的大小，主要用于存放key和metadata（如：使用次数） </span><br><span class="line"> inactive=120s； #缓存有效时间 </span><br><span class="line"> max_size=1g; #最大磁盘占用空间，磁盘存入文件内容的缓存空间最大值</span><br><span class="line"></span><br><span class="line"><span class="section">#调用缓存功能，需要定义在相应的配置段，如server&#123;...&#125;；或者location等</span></span><br><span class="line">   proxy_cache proxycache;</span><br><span class="line">   proxy<span class="emphasis">_cache_</span>key $request_uri;</span><br><span class="line">   proxy<span class="emphasis">_cache_</span>valid 200 302 301 10m; #指定的状态码返回的数据缓存多长时间</span><br><span class="line">   proxy<span class="emphasis">_cache_</span>valid any 1m;</span><br><span class="line"></span><br><span class="line">proxy<span class="emphasis">_cache_</span>use<span class="emphasis">_stale error http_</span>502 http_503;</span><br><span class="line"><span class="section">#在被代理的后端服务器出现哪种情况下，可直接使用过期的缓存响应客户端，</span></span><br><span class="line">proxy<span class="emphasis">_cache_</span>use<span class="emphasis">_stale error | timeout | invalid_</span>header | updating | http<span class="emphasis">_500 | http_</span>502</span><br><span class="line">| http<span class="emphasis">_503 | http_</span>504 | http<span class="emphasis">_403 | http_</span>404 | off ; #默认是off</span><br><span class="line"></span><br><span class="line">proxy<span class="emphasis">_cache_</span>methods GET | HEAD | POST ...;</span><br><span class="line"><span class="section">#对哪些客户端请求方法对应的响应进行缓存，GET和HEAD方法总是被缓存</span></span><br></pre></td></tr></table></figure></div>
<h4 id="1-2-5：添加头部报文信息"><a href="#1-2-5：添加头部报文信息" class="headerlink" title="1.2.5：添加头部报文信息"></a>1.2.5：添加头部报文信息</h4><p><strong>nginx基于模块ngx_http_headers_module可以实现对头部报文添加指定的key与值</strong></p>
<p>#参考文档： <a href="https://nginx.org/en/docs/http/ngx_http_headers_module.html" target="_blank" rel="noopener">https://nginx.org/en/docs/http/ngx_http_headers_module.html</a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Syntax: add_header name value [always];</span><br><span class="line">Default: —</span><br><span class="line">Context: http, server, location, <span class="keyword">if</span> <span class="keyword">in</span> location</span><br><span class="line"><span class="comment">#添加自定义首部，如下：</span></span><br><span class="line">add_header name value [always];</span><br><span class="line">add_header X-Via  <span class="variable">$server_addr</span>;</span><br><span class="line">add_header X-Cache <span class="variable">$upstream_cache_status</span>;</span><br><span class="line">add_header X-Accel <span class="variable">$server_name</span>;</span><br><span class="line"><span class="comment">#添加自定义响应信息的尾部， 1.13.2版后支持</span></span><br><span class="line">add_trailer name value [always];</span><br></pre></td></tr></table></figure></div>
<ul>
<li><strong>Nginx配置</strong></li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">location /web &#123;</span><br><span class="line"> proxy_pass http://192.168.66.17:80/;</span><br><span class="line"> proxy_set_header clientip <span class="variable">$remote_addr</span>;</span><br><span class="line"> proxy_cache proxycache;</span><br><span class="line"> proxy_cache_key <span class="variable">$request_uri</span>;</span><br><span class="line"> proxy_cache_valid 200 302 301 1h;</span><br><span class="line"> proxy_cache_valid any 1m;</span><br><span class="line"> add_header X-Via  <span class="variable">$server_addr</span>;</span><br><span class="line"> add_header X-Cache <span class="variable">$upstream_cache_status</span>;</span><br><span class="line"> add_header X-Accel <span class="variable">$server_name</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p><strong>验证头部信息：</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]<span class="comment"># curl -v 127.0.0.1/app1/</span></span><br><span class="line">* About to connect() to 127.0.0.1 port 80 (<span class="comment">#0)</span></span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* Connected to 127.0.0.1 (127.0.0.1) port 80 (<span class="comment">#0)</span></span><br><span class="line">&gt; GET /app1/ HTTP/1.1</span><br><span class="line">&gt; User-Agent: curl/7.29.0</span><br><span class="line">&gt; Host: 127.0.0.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; Server: nginx/1.16.1</span><br><span class="line">&lt; Date: Tue, 07 Jan 2020 08:56:28 GMT</span><br><span class="line">&lt; Content-Type: text/html; charset=UTF-8</span><br><span class="line">&lt; Content-Length: 29</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt; Last-Modified: Tue, 07 Jan 2020 07:05:23 GMT</span><br><span class="line">&lt; ETag: <span class="string">"1d-59b87665f5400"</span></span><br><span class="line">&lt; X-Via: 127.0.0.1</span><br><span class="line">&lt; X-Cache: MISS    <span class="comment">#----&gt;第一次访问没有缓存</span></span><br><span class="line">&lt; X-Accel: www.daming.net</span><br><span class="line">&lt; Accept-Ranges: bytes</span><br><span class="line">&lt; </span><br><span class="line">app1 web page by web1 server</span><br><span class="line">* Connection <span class="comment">#0 to host 127.0.0.1 left intact</span></span><br><span class="line">[root@nginx ~]<span class="comment"># tree /apps/nginx/proxycache/</span></span><br><span class="line">/apps/nginx/proxycache/</span><br><span class="line">└── b</span><br><span class="line">    └── 27</span><br><span class="line">        └── 73</span><br><span class="line">            └── 45efea0da7a0718cc36ddeda8747327b</span><br><span class="line"></span><br><span class="line">3 directories, 1 file</span><br><span class="line">[root@nginx ~]<span class="comment"># curl -v 127.0.0.1/app1/</span></span><br><span class="line">* About to connect() to 127.0.0.1 port 80 (<span class="comment">#0)</span></span><br><span class="line">*   Trying 127.0.0.1...</span><br><span class="line">* Connected to 127.0.0.1 (127.0.0.1) port 80 (<span class="comment">#0)</span></span><br><span class="line">&gt; GET /app1/ HTTP/1.1</span><br><span class="line">&gt; User-Agent: curl/7.29.0</span><br><span class="line">&gt; Host: 127.0.0.1</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; Server: nginx/1.16.1</span><br><span class="line">&lt; Date: Tue, 07 Jan 2020 08:57:04 GMT</span><br><span class="line">&lt; Content-Type: text/html; charset=UTF-8</span><br><span class="line">&lt; Content-Length: 29</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt; Last-Modified: Tue, 07 Jan 2020 07:05:23 GMT</span><br><span class="line">&lt; ETag: <span class="string">"1d-59b87665f5400"</span></span><br><span class="line">&lt; X-Via: 127.0.0.1</span><br><span class="line">&lt; X-Cache: HIT  <span class="comment">#第二次缓存命中</span></span><br><span class="line">&lt; X-Accel: www.daming.net</span><br><span class="line">&lt; Accept-Ranges: bytes</span><br><span class="line">&lt; </span><br><span class="line">app1 web page by web1 server</span><br><span class="line">* Connection <span class="comment">#0 to host 127.0.0.1 left intact</span></span><br></pre></td></tr></table></figure></div>
<h2 id="2-Nginx-http-反向代理高级应用"><a href="#2-Nginx-http-反向代理高级应用" class="headerlink" title="2. Nginx http 反向代理高级应用"></a>2. Nginx http 反向代理高级应用</h2><p><strong>在上一个章节中Nginx可以将客户端的请求转发至单台后端服务器但是无法转发至特定的一组的服务器，而且不能对后端服务器提供相应的服务器状态监测，但是Nginx可以基于ngx_http_upstream_module模块提供服务器分组转发、权重分配、状态监测、调度算法等高级功能</strong></p>
<ul>
<li>#官方文档：<br>   #<a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html" target="_blank" rel="noopener">https://nginx.org/en/docs/http/ngx_http_upstream_module.html</a></li>
</ul>
<h3 id="2-1-http-upstream配置参数"><a href="#2-1-http-upstream配置参数" class="headerlink" title="2.1 http upstream配置参数"></a>2.1 http upstream配置参数</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">upstream name &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#自定义一组服务器，配置在http内</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server address [parameters];</span><br><span class="line"><span class="comment">#配置一个后端web服务器，配置在upstream内，至少要有一个server服务器配置。</span></span><br><span class="line"><span class="comment">#server支持的parameters如下：</span></span><br><span class="line">weight=number <span class="comment">#设置权重，默认为1。</span></span><br><span class="line">max_conns=number  <span class="comment">#给当前server设置最大活动链接数，默认为0表示没有限制。</span></span><br><span class="line">max_fails=number  <span class="comment">#对后端服务器连续监测失败多少次就标记为不可用。</span></span><br><span class="line">fail_timeout=time <span class="comment">#对后端服务器的单次监测超时时间，默认为10秒。</span></span><br><span class="line">backup  <span class="comment">#设置为备份服务器，当所有服务器不可用时将重新启用次服务器。</span></span><br><span class="line">down   <span class="comment">#标记为down状态。</span></span><br><span class="line">resolve <span class="comment">#当server定义的是主机名的时候，当A记录发生变化会自动应用新IP而不用重启Nginx。</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">hash</span> KEY consistent；</span><br><span class="line"><span class="comment">#基于指定key做hash计算，使用consistent参数，将使用ketama一致性hash算法，适用于后端是Cache服务器</span></span><br><span class="line">（如varnish）时使用，consistent定义使用一致性<span class="built_in">hash</span>运算，一致性<span class="built_in">hash</span>基于取模运算。</span><br><span class="line"><span class="built_in">hash</span> <span class="variable">$request_uri</span> consistent; <span class="comment">#基于用户请求的uri做hash</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip_hash；</span><br><span class="line"><span class="comment">#源地址hash调度方法，基于的客户端的remote_addr(源地址)做hash计算，以实现会话保持</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">least_conn;</span><br><span class="line"><span class="comment">#最少连接调度算法，优先将客户端请求调度到当前连接最少的后端服务器</span></span><br></pre></td></tr></table></figure></div>
<h4 id="2-1-1-反向代理示例–多台web服务器"><a href="#2-1-1-反向代理示例–多台web服务器" class="headerlink" title="2.1.1 反向代理示例–多台web服务器"></a>2.1.1 反向代理示例–多台web服务器</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">upstream webserver &#123;</span><br><span class="line"> 	<span class="comment">#hash $request_uri consistent;</span></span><br><span class="line">	 <span class="comment">#ip_hash；</span></span><br><span class="line">	 <span class="comment">#least_conn;</span></span><br><span class="line">	server 192.168.66.17:80 weight=1 fail_timeout=5s 			max_fails=3; <span class="comment">#后端服务器状态监测</span></span><br><span class="line">	server 192.168.66.27:80 weight=1 fail_timeout=5s max_fails=3;</span><br><span class="line">	server  192.168.66.7:80 weight=1 fail_timeout=5s max_fails=3 backup;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name www.daming.net;</span><br><span class="line">	location / &#123;</span><br><span class="line"> 		index index.html index.php;</span><br><span class="line"> 		root /data/nginx/html/pc;</span><br><span class="line"> &#125;</span><br><span class="line">	location /web &#123;</span><br><span class="line"> 		index index.html;</span><br><span class="line"> 		proxy_pass http://webserver/;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#重启Nginx 并访问测试</span></span><br><span class="line"></span><br><span class="line">[root@s2 ~]<span class="comment"># curl  http://www.daming.net/web</span></span><br><span class="line">web1 192.168.66.17</span><br><span class="line">[root@s2 ~]<span class="comment"># curl http://www.daming.net/web</span></span><br><span class="line">web2 192.168.66.27</span><br></pre></td></tr></table></figure></div>
<p><strong>关闭192.168.66.17和192.168.66.27，测试nginx backup服务器可用性</strong></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@s4 ~]<span class="comment"># while true;do curl http://www.daming.net/web;sleep 1;done</span></span><br><span class="line"><span class="comment"># 测试轮询？</span></span><br></pre></td></tr></table></figure></div>
<h4 id="2-1-2-反向代理示例–客户端IP透传"><a href="#2-1-2-反向代理示例–客户端IP透传" class="headerlink" title="2.1.2 反向代理示例–客户端IP透传"></a>2.1.2 反向代理示例–客户端IP透传</h4><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@s2 conf.d]<span class="comment"># cat pc.conf</span></span><br><span class="line">upstream webserver &#123;</span><br><span class="line"> <span class="comment">#hash $request_uri consistent; #consistent 一致性hash算法</span></span><br><span class="line"> <span class="comment">#server 192.168.7.103:80 weight=1 fail_timeout=5s max_fails=3;</span></span><br><span class="line">	server 192.168.66.27:80 weight=1 fail_timeout=5s max_fails=3;</span><br><span class="line">	server  192.168.66.7:80 weight=1 fail_timeout=5s max_fails=3 backup;</span><br><span class="line">&#125;</span><br><span class="line">	server &#123;</span><br><span class="line">		listen 80;</span><br><span class="line">		server_name www.daming.net;</span><br><span class="line">		location / &#123;</span><br><span class="line">			 index index.html index.php;</span><br><span class="line">			 root /data/nginx/html/pc;</span><br><span class="line"> 		&#125;</span><br><span class="line">		location /web &#123;</span><br><span class="line">			 index index.html;</span><br><span class="line"> 			 proxy_pass http://webserver/;</span><br><span class="line"> 			 proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>; <span class="comment">#添加客户端IP到报文头部</span></span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#重启nginx</span></span><br><span class="line"><span class="comment">#后端web服务器配置</span></span><br><span class="line">1、Apache：</span><br><span class="line">[root@s4 ~]<span class="comment"># vim /etc/httpd/conf/httpd.conf</span></span><br><span class="line">LogFormat <span class="string">"%&#123;X-Forwarded-For&#125;i %h %l %u %t \"%r\" %&gt;s %b \"%&#123;Referer&#125;i\" \"%&#123;User-</span></span><br><span class="line"><span class="string">Agent&#125;i\""</span> combined</span><br><span class="line"><span class="comment">#重启apache访问web界面并验证apache日志</span></span><br><span class="line"></span><br><span class="line">2、Nginx：</span><br><span class="line">[root@s1 conf.d]<span class="comment"># cat /apps/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="string">"<span class="variable">$http_x_forwarded_for</span>"</span><span class="string">' #默认日志格式就有此配置</span></span><br><span class="line"><span class="string">重启nginx访问web界面并验证日志格式</span></span><br></pre></td></tr></table></figure></div>



</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">曹志明</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://caohziming.net/post/31787.html">https://caohziming.net/post/31787.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://caohziming.net">Miij's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Nginx/">Nginx    </a></div><div class="post_share"><div class="social-share" data-image="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=240325162,3759124968&amp;fm=26&amp;gp=0.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/post/9192.html"><img class="prev_cover lazyload" data-src="https://oscimg.oschina.net/oscnet/cb15f52273e21a507186489aefea56734d8.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>haproxy 安装及主配参数详解</span></div></a></div><div class="next-post pull_right"><a href="/post/48525.html"><img class="next_cover lazyload" data-src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=240325162,3759124968&amp;fm=26&amp;gp=0.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Nginx Rewrite</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/post/38641.html" title="Nginx变量"><img class="relatedPosts_cover lazyload"data-src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=240325162,3759124968&fm=26&gp=0.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-09</div><div class="relatedPosts_title">Nginx变量</div></div></a></div><div class="relatedPosts_item"><a href="/post/48525.html" title="Nginx Rewrite"><img class="relatedPosts_cover lazyload"data-src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=240325162,3759124968&fm=26&gp=0.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-09</div><div class="relatedPosts_title">Nginx Rewrite</div></div></a></div><div class="relatedPosts_item"><a href="/post/9355.html" title="Nginx 核心配置"><img class="relatedPosts_cover lazyload"data-src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=240325162,3759124968&fm=26&gp=0.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-09</div><div class="relatedPosts_title">Nginx 核心配置</div></div></a></div><div class="relatedPosts_item"><a href="/post/49679.html" title="Nginx日志"><img class="relatedPosts_cover lazyload"data-src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=240325162,3759124968&fm=26&gp=0.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-09</div><div class="relatedPosts_title">Nginx日志</div></div></a></div><div class="relatedPosts_item"><a href="/post/31024.html" title="Nginx编译安装"><img class="relatedPosts_cover lazyload"data-src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=240325162,3759124968&fm=26&gp=0.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-09</div><div class="relatedPosts_title">Nginx编译安装</div></div></a></div></div><div class="clear_both"></div></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 曹志明</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://caozhiming.net" target="_blank" rel="noopener">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="true" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script></body></html>